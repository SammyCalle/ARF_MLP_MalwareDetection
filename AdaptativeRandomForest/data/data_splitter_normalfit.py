import numpy as np
import pandas as pd
import pickle

with open(r'AdaptativeRandomForest\\data\\experiment_3\\data_cleaned.pkl', 'rb') as f:
    data = pickle.load(f)

def data_splitter (data):
    back_counter = 2
    X_train_list = []
    y_train_list = []
    X_test_list = []
    y_test_list = []
    for i in range(len(data)):
        concat_X = []
        concat_y = []
        concat_X.clear
        concat_y.clear
        if  i == 0 :
            continue
        else :
            for j in range(1,back_counter):
                X = data[i-j].drop(['Malware','HighestModDate'],axis= 1).values
                y = data[i-j]['Malware'].values
                concat_X.append(X)
                concat_y.append(y)
        X_test = data[i].drop(['Malware','HighestModDate'],axis= 1).values
        y_test = data[i]['Malware'].values
        X_train = np.concatenate(concat_X)
        y_train = np.concatenate(concat_y)
        
        X_train_list.append(X_train)
        y_train_list.append(y_train)
        X_test_list.append(X_test)
        y_test_list.append(y_test)

    return X_train_list, y_train_list, X_test_list, y_test_list

def data_splitter_pf(data):
    X_train_list = []
    y_train_list = []
    X_test_list = []
    y_test_list = []

    for i in range(len(data)):
        concat_X = []
        concat_y = []
        concat_X.clear
        concat_y.clear
        if(i == len(data)-1) :
            break
        X_train = data[i].drop(['Malware','HighestModDate'],axis= 1).values
        y_train = data[i]['Malware'].values
        X_test = data[i+1].drop(['Malware','HighestModDate'],axis= 1).values
        y_test = data[i+1]['Malware'].values
       
        X_train_list.append(X_train)
        y_train_list.append(y_train)
        X_test_list.append(X_test)
        y_test_list.append(y_test)

    return X_train_list, y_train_list, X_test_list, y_test_list

X_train_list, y_train_list, X_test_list, y_test_list = data_splitter_pf(data = data)

filename = 'X_train.pkl'
filename2= 'y_train.pkl'
filename3 = 'X_test.pkl'
filename4= 'y_test.pkl'

with open(r'AdaptativeRandomForest\\data\\experiment_3\\splitted_data_partialandOnline\\'+filename, 'wb') as f :
    pickle.dump(X_train_list, f)

with open(r'AdaptativeRandomForest\\data\\experiment_3\\splitted_data_partialandOnline\\'+filename2, 'wb') as f :
    pickle.dump(y_train_list, f)

with open(r'AdaptativeRandomForest\\data\\experiment_3\\splitted_data_partialandOnline\\'+filename3, 'wb') as f :
    pickle.dump(X_test_list, f)

with open(r'AdaptativeRandomForest\\data\\experiment_3\\splitted_data_partialandOnline\\'+filename4, 'wb') as f :
    pickle.dump(y_test_list, f)

